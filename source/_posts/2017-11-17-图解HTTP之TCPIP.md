---
layout: post
title: 图解HTTP协议笔记之TCP/IP
categories: Internet
tags:  TCP/IP 
author: Marnner
excerpt: 图解HTTP协议笔记之TCP/IP
grammar_cjkRuby: true
---

* content
{:toc}


- # 图解HTTP协议笔记

  ## HTTP

  全名HyperText Transfer Protocol,超文本传输协议。

  ## TCP/IP

  通常使用的网络，包括互联网是在TCP/IP协议族的基础上运作的。而HTTP属于它内部的一个子集。

  常见的协议有TCP,FTP,UDP,IP等等，TCP/IP是互联网相关的各类协议族的总称。像这样把互联网相关的协议集合起来总称为TCP/IP。

  ### TCP/IP的分层管理

  TCP/IP协议族里重要的一点就是分层，TCP/IP协议族按层次分别为以下4层，它们分别是：

  *   应用层

  *   传输层

  *   网络层

  *   数据链路层

  层次化之后，设计也变得相对简单了，处于应用层的应用可以只考虑分派给自己的任务，而不需要弄清对方在地球上那个地方，对方的传输路线是怎样的，是否能确保传输送达等问题。

  #### 应用层

  应用层决定了向用户提供应用服务时的活动。

  TCP/IP协议族内预存了各类通用的应用服务，比如，FTP（File Transfer Protocol,文件传输协议)和DNS（Domain Name System，域名系统）服务就是其中的两类。

  #### 传输层

  传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。

  在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和UDP（User Date Protocol，用户数据报协议）。

  #### 网络层 （又称网络互联层）

  网络层用来处理在网络上流动的数据包，数据包是网络传输的最小数据单位，该层规定了通过怎样的路径（所谓的传输路线）到达对方的计算机，并把数据包传送给对方。

  与对方的计算机之间通过多台计算机或者网络设备进行传输时，网络层的作用就是在众多的选项内选择一条传输路线。

  #### 链路层（又名数据链路层，网络接口层）

  用来处理链接网络的硬件部分。包括控制操作系统，硬件的设备驱动，NIC（Network Interface Card，网络适配器，即网卡），以及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。

  在进行网络通信时，一般通过分层顺序与对方进行通信，发送端从应用层往下走，接收端则往应用层往上走。

  eg:客户端请求服务端通讯例子：

  客户端：应用层(HTTP) --> 传输层(TCP) --> 网络层(IP)--> 链路层(网络) ↓
  服务端： 应用层(HTTP) --> 传输层(TCP) --> 网络层(IP)--> 链路层(网络)←

  *   客户端在应用层（HTTP协议)发出一个想看某个Web页面的HTTP请求。

  *   传输层（TCP协议）把从应用层接收到的数据（HTTP请求报文）进行分割，并在各个报文上标记序号以及端口号后转发给网络层。

  *   网络层（IP协议），增加作为通信目的地的MAC地址后转发给链路层，这样一来，发送网络的通信请求就准备齐全了。

  接收端的服务器在链路层收到数据，按序往上层发送，一直到应用层，当传输到应用层的时候，才能真正接收到由客户端发送过来的HTTP请求。

  发送端在层与层之间传输数据的时候，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层时会把对应的首部消去。

  这种把数据信息包装起来的做法称为封装（encapsulate）。

  ### 1.4 与HTTP关系密切的协议:IP,TCP和DNS

  #### 负责传输的IP协议

  按层次来分，IP（Internet Protocol)互联网协议，几乎所有的使用网络的系统都会用到IP协议，”IP“其实是一种协议。和“IP”地址无关。

  IP协议的作用是把各种数据包传送给对方，而要保证确实传送到对方那里，则需要满足各类条件，其中连个重要的条件就是IP地址，和MAC地址（Media Access Control Address）

  IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定的地址。IP地址可以和MAC地址进行配对。IP地址可以变换，但是MAC地址基本上不会更改。

  使用ARP协议凭借MAC地址进行通讯。

  IP间的通信依赖MAC地址，在网络上，通讯的双方在同一局域网（LAN）内的请情况是很少的，通常是经过多台计算机和网络设备中转才能连接到对方。而在中转时，会利用下一站中转设备的MAC地址来搜索下一个中转目标，这时，会采用ARP协议（Address Resolution Protocol）。ARP是一种用以解析地址的协议，根据通信方的IP地址就可以反查处对应的MAC地址。在中转过程中，还会有路由器等网络设备进行路由选择，有点像快递公司的送货过程。

  #### 确保可靠性的TCP协议

  按层次来分，TCP位于传输层，提供可靠的字节流服务。

  所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。

  而可靠的传输服务是指，能够把数据准确可靠地传给对方。一言以蔽之，TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否到达对方。确保数据能到达目标，为了准确无误地将数据送达目标处，TCP协议采用了三次握手（three-way handshaking）策略。用TCP协议把数据包送出去后，TCP不会对传送后的情况置之不理，他一定会向对方确认是否成功送达。

  握手过程中使用了TCP的标志（flag） -------SYN（synchronize)和ACK（acknowledgement)。

  什么意思呢？发送端先发送一个带有SYN标志的数据包给对方，接收端收到之后，回传一个带有SYN/ACK 标志的数据包以表示传达确认信息。最后，发送端在回传一个带ACK标志的数据包，代表“握手”结束。

  如果在握手的过程中某个阶段莫名的中断，TCP协议会再次以相同的顺序发送相同的数据包。除了这种三次握手之外，TCP协议还有其他各种手段来保证通信的可靠性。

  #### 负责域名解析的DNS服务

  DNS（Domain Name System）服务是和HTTP协议一样位于应用层的协议，它提供域名带IP地址之间的解析服务。

  计算机既可以被赋予IP地址，也可以被赋予主机名和域名，比如

  [www.gogle.com](www.google.com)。

  DNS协议提供通过域名查找IP地址，或者逆向的从IP地址反查找域名的服务。

  最后我们通过一张图来看各种协议和HTTP协议之间的关系。

  ![image.png](http://upload-images.jianshu.io/upload_images/8565418-547832abd8b34726.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

  ​